import{createRequire as B}from"node:module";var M=Object.create;var{getPrototypeOf:O,defineProperty:v,getOwnPropertyNames:w}=Object;var I=Object.prototype.hasOwnProperty;var H=(R,K,q)=>{q=R!=null?M(O(R)):{};let z=K||!R||!R.__esModule?v(q,"default",{value:R,enumerable:!0}):q;for(let E of w(R))if(!I.call(z,E))v(z,E,{get:()=>R[E],enumerable:!0});return z};var V=B(import.meta.url);var N=typeof globalThis!=="undefined"&&typeof globalThis.wx!=="undefined"&&typeof globalThis.wx.getSystemInfoSync==="function",F=typeof globalThis!=="undefined"&&typeof globalThis.window!=="undefined"&&typeof globalThis.document!=="undefined"||N,X=typeof globalThis!=="undefined"&&typeof globalThis.process!=="undefined"&&globalThis.process?.versions?.node&&!F,k={black:"color: #000000",red:"color: #ff0000",green:"color: #008000",yellow:"color: #ffff00",blue:"color: #0000ff",magenta:"color: #ff00ff",cyan:"color: #00ffff",white:"color: #ffffff",gray:"color: #808080",grey:"color: #808080",redBright:"color: #ff5555",greenBright:"color: #55ff55",yellowBright:"color: #ffff55",blueBright:"color: #5555ff",magentaBright:"color: #ff55ff",cyanBright:"color: #55ffff",whiteBright:"color: #ffffff",bgBlack:"background-color: #000000; color: #ffffff",bgRed:"background-color: #ff0000; color: #ffffff",bgGreen:"background-color: #008000; color: #ffffff",bgYellow:"background-color: #ffff00; color: #000000",bgBlue:"background-color: #0000ff; color: #ffffff",bgMagenta:"background-color: #ff00ff; color: #ffffff",bgCyan:"background-color: #00ffff; color: #000000",bgWhite:"background-color: #ffffff; color: #000000",bgRedBright:"background-color: #ff5555; color: #ffffff; padding: 2px 4px; border-radius: 3px",bgGreenBright:"background-color: #55ff55; color: #000000; padding: 2px 4px; border-radius: 3px",bgYellowBright:"background-color: #ffff55; color: #000000; padding: 2px 4px; border-radius: 3px",bgBlueBright:"background-color: #5555ff; color: #ffffff; padding: 2px 4px; border-radius: 3px",bgMagentaBright:"background-color: #ff55ff; color: #ffffff; padding: 2px 4px; border-radius: 3px",bgCyanBright:"background-color: #55ffff; color: #000000; padding: 2px 4px; border-radius: 3px",bgWhiteBright:"background-color: #ffffff; color: #000000; padding: 2px 4px; border-radius: 3px",bold:"font-weight: bold",dim:"opacity: 0.5",italic:"font-style: italic",underline:"text-decoration: underline",strikethrough:"text-decoration: line-through"},Y=null;async function L(){if(!Y&&X&&!F)try{Y=(await import("chalk")).default}catch(R){if(X)A("Failed to load chalk:",R)}return Y}function Z(R=[],K){if(F){let q=R.map((z)=>k[z]).filter(Boolean).join("; ");return{text:K,styles:q||void 0}}else{if(Y)return{text:R.reduce((z,E)=>{if(E in Y)return Y[E](z);return z},K)};return{text:K}}}function A(...R){try{if(typeof console!=="undefined"&&console&&typeof console.log==="function")console.log(...R)}catch(K){}}function _(R,K){if(F&&K&&K.length>0){let{text:q,styles:z}=Z(K,R);if(z)A(`%c${q}`,z);else A(q)}else if(!F&&Y){let{text:q}=Z(K,R);A(q)}else A(R)}if(X&&!F)L();function D(R){return new Promise((K)=>setTimeout(K,R))}var m={getUserAgent(){try{return typeof navigator!=="undefined"&&navigator?.userAgent?navigator.userAgent:"Unknown UserAgent"}catch{return"Unknown UserAgent"}},hasStorageAPI(){try{if(typeof navigator==="undefined"||!navigator)return!1;let R=navigator;return"storage"in R&&R.storage!==void 0&&typeof R.storage.estimate==="function"}catch{return!1}},async getStorageEstimate(){try{if(this.hasStorageAPI())return await navigator.storage.estimate();return null}catch{return null}},isAvailable(){try{return typeof navigator!=="undefined"&&navigator!==null}catch{return!1}},isWeChatMiniapp(){try{return typeof globalThis!=="undefined"&&typeof globalThis.wx!=="undefined"&&typeof globalThis.wx.getSystemInfoSync==="function"}catch{return!1}},getWeChatSystemInfo(){try{if(this.isWeChatMiniapp())return globalThis.wx.getSystemInfoSync();return null}catch{return null}},getEnhancedUserAgent(){try{if(this.isWeChatMiniapp()){let R=this.getWeChatSystemInfo();if(R)return`WeChat-Miniapp/${R.version} (${R.system}; ${R.model}) MicroMessenger/${R.SDKVersion}`;return"WeChat-Miniapp/Unknown"}return this.getUserAgent()}catch{return this.getUserAgent()}},getEnvironmentInfo(){let R=this.isWeChatMiniapp();return{isWeChatMiniapp:R,isNavigatorAvailable:this.isAvailable(),hasStorageAPI:this.hasStorageAPI(),userAgent:this.getEnhancedUserAgent(),...R&&{weChatSystemInfo:this.getWeChatSystemInfo()}}}};var U=null,P=null;async function S(){if(X&&!F&&!U)try{let[R,K]=await Promise.all([import("chalk"),import("ora")]);U=R.default,P=K.default}catch(R){if(X&&!F)A("Failed to load Node.js modules:",R)}}if(X&&!F)S();function W(R=[],K){if(F){let{text:q}=Z(R,K);return q}else if(U)return R.reduce((q,z)=>{if(z in U)return U[z](q);return q},K);return K}class J{_text=null;_textStyles=[];_detail=null;_detailStyles=[];_prefix=null;_prefixStyles=[];_data;_displayTime=!1;_loggerType="normal";_prependDivider=!1;_prependDividerStyles=[];_prependDividerLength=1;_prependDividerChar="-";_appendDivider=!1;_appendDividerStyles=[];_appendDividerChar="-";_appendDividerLength=1;_singleDivider=!1;_singleDividerStyles=[];_singleDividerChar="-";_singleDividerLength=1;_isVisible=!0;constructor(R){R&&(this._prefixStyles=R)}static stylesMap={info:["blueBright","underline"],warn:["bgYellowBright"],error:["bgRedBright"],debug:["bgCyanBright"],success:["bgGreenBright"],failure:["bgRedBright"],plain:["white"]};static getLoggerInstance(R,K){return K&&(J.stylesMap[R]=K),new this(J.stylesMap[R])}static type(R,K){if(R in J&&K)if(F)A(`%cLogger type "${String(R)}" is preset. Add custom getter will override the preset.`,"color: #ffff00; text-decoration: underline");else if(U)A(U.yellow.underline(`Logger type "${String(R)}" is preset. Add custom getter will override the preset.`));else A(`Logger type "${String(R)}" is preset. Add custom getter will override the preset.`);let q=J.getLoggerInstance(R,K);return Object.defineProperty(J,R,{get(){return q},configurable:!0,enumerable:!0}),q}static get stream(){return new b}toStream(R,K){let q=new b(R,K);if(this._text)q.text(this._text,this._textStyles);if(this._detail)q.detail(this._detail,this._detailStyles);if(this._data)q.data(this._data);return q}static get plain(){return this.getLoggerInstance("plain")}static get info(){return this.getLoggerInstance("info")}static get warn(){return this.getLoggerInstance("warn")}static get error(){return this.getLoggerInstance("error")}static get debug(){return this.getLoggerInstance("debug")}static get success(){return this.getLoggerInstance("success")}static get failure(){return this.getLoggerInstance("failure")}setDividerProperties(R,K="-",q=40,z=["gray"]){let E=R==="prepend"?"_prependDivider":R==="append"?"_appendDivider":"_singleDivider";this[`${E}`]=!0,this[`${E}Char`]=K||this[`${E}Char`],this[`${E}Styles`]=z||this[`${E}Styles`],this[`${E}Length`]=q||(K&&K.length===1?40:this[`${E}Length`])}divider(R,K,q){this.setDividerProperties("single",R,K,q),this.print()}styles(R){return this._textStyles=R,this}prependDivider(R,K,q){return this.setDividerProperties("prepend",R,K,q),this}appendDivider(R,K,q){return this.setDividerProperties("append",R,K,q),this}time(R=!0){return this._displayTime=R,this}get formattedTime(){return this._displayTime?`${new Date().toLocaleTimeString()} `:""}text(R,K){return this._text=R,K&&(this._textStyles=K),this}get formattedText(){return this._text?`${this.decorateText(this._text,this._textStyles)} `:""}detail(R,K){return this._detail=R,K&&(this._detailStyles=K),this}get formattedDetail(){return this._detail?`
${this.decorateText(this._detail,this._detailStyles)}`:""}prefix(R,K){return this._prefix=R,K&&(this._prefixStyles=K),this}get formattedPrefix(){return this._prefix?`${this.decorateText(this._prefix,this._prefixStyles)} `:""}data(R){return this._data=R,this}get formattedData(){return this._data?`
${this._data}`:""}decorateText(R,K){let q=R||"";if(q)if(F)q=q.replace(/\[\[(.+?)\]\]/g,"$1");else if(U)q=q.replace(/\[\[(.+?)\]\]/g,U.underline.yellow("$1"));else q=q.replace(/\[\[(.+?)\]\]/g,"$1");return W(K,q)}composeMainOutput(){if(this.formattedTime||this.formattedText||this.formattedDetail||this.formattedData||this._loggerType==="normal"&&this.formattedPrefix)return`${this.formattedTime}${this._loggerType==="normal"?this.formattedPrefix:""}${this.formattedText}${this.formattedDetail}${this.formattedData}`;return""}print(R=!0){if(this._isVisible=R,!this._isVisible)return;if(this._singleDivider){let q=this._singleDividerChar.repeat(this._singleDividerLength);if(F)_(q,this._singleDividerStyles);else A(W(this._singleDividerStyles,q));return}if(this._prependDivider){let q=this._prependDividerChar.repeat(this._prependDividerLength);if(F)_(q,this._prependDividerStyles);else A(W(this._prependDividerStyles,q))}let K=this.composeMainOutput();if(F)this.printBrowserOutput(K);else A(K);if(this._appendDivider){let q=this._appendDividerChar.repeat(this._appendDividerLength);if(F)_(q,this._appendDividerStyles);else A(W(this._appendDividerStyles,q))}}printBrowserOutput(R){if(!R)return;let K=R.includes("[[")&&R.includes("]]"),q=R.match(/^\d{1,2}:\d{2}:\d{2}(?:\s[AP]M)?\s/);if(K||q||this._prefixStyles.length>0||this._textStyles.length>0){let z=[],E=[],Q=R;if(q&&this._displayTime)z.push(`%c${q[0]}`),E.push("color: #888; font-size: 0.9em"),Q=Q.substring(q[0].length);if(this._prefix&&this._loggerType==="normal"){let{styles:$}=Z(this._prefixStyles,`${this._prefix} `);if($)z.push(`%c${this._prefix} `),E.push($);else z.push(`${this._prefix} `);Q=Q.replace(`${this._prefix} `,"")}if(K)Q.split(/(\[\[.+?\]\])/).forEach((j)=>{if(j.match(/\[\[.+?\]\]/)){let G=j.replace(/\[\[(.+?)\]\]/g,"$1");z.push(`%c${G}`),E.push("text-decoration: underline; color: #ffff00; font-weight: bold")}else if(j.trim()){let{styles:G}=Z(this._textStyles,j);if(G)z.push(`%c${j}`),E.push(G);else z.push(j)}});else if(Q){let{styles:$}=Z(this._textStyles,Q);if($)z.push(`%c${Q}`),E.push($);else z.push(Q)}if(z.length>0)A(z.join(""),...E)}else A(R)}capitalize(R){return R.charAt(0).toUpperCase()+R.slice(1)}get[Symbol.toStringTag](){return"ShermanLoggerClass"}toString(){return this.composeMainOutput().toString()}toObject(){return this}}class b extends J{_state=void 0;_spinner=void 0;_delay=0;constructor(R,K){super(K||[]);if(this._loggerType="stream",F)this._spinner=void 0,A("%c[STREAM STARTED]","color: #00ff00; font-weight: bold");else if(P)this._spinner=P(),this._spinner?.start();else this._spinner=void 0,A("[STREAM STARTED]");return this._state="start",R&&this.prefix(R,K),this}prefix(R,K){if(this._prefix=R,K&&(this._prefixStyles=K),this._spinner)this._spinner.prefixText=this.decorateText(this._prefix,this._prefixStyles);else if(F)A(`%c[PREFIX SET: ${R}]`,"color: #888; font-style: italic;");return this}text(R="",K){return this._text=R,K&&(this._textStyles=K),this}detail(R="",K){return this._detail=R,K&&(this._detailStyles=K),this}delay(R){return this._delay=R,this}state(R){return this._state=R,this}update(){if(this._state)this.updateState(this._state);else if(this._spinner)this._spinner.text=this.composeMainOutput();else if(F){let R=this.composeMainOutput();if(R)A(`%c[STREAM UPDATE] ${R}`,"color: #00aaff")}}async asyncUpdate(R){this.update();let K=this._delay||R;if(K)await D(K),this._delay&&(this._delay=0)}updateState(R){let K=this.composeMainOutput();if(this._spinner)switch(R){case"start":this._spinner.start(K);break;case"stop":this._spinner.stop(),this._spinner=void 0;break;case"succeed":this._spinner.succeed(K),this._spinner=void 0;break;case"fail":this._spinner.fail(K),this._spinner=void 0;break}else if(F)switch(R){case"start":A(`%c[STREAM STARTED] ${K}`,"color: #00ff00; font-weight: bold");break;case"stop":A(`%c[STREAM STOPPED] ${K}`,"color: #ff8800; font-weight: bold");break;case"succeed":A(`%c✓ [STREAM SUCCESS] ${K}`,"color: #00ff00; font-weight: bold");break;case"fail":A(`%c✗ [STREAM FAILED] ${K}`,"color: #ff0000; font-weight: bold");break}else switch(R){case"start":A(`[STREAM STARTED] ${K}`);break;case"stop":A(`[STREAM STOPPED] ${K}`);break;case"succeed":A(`✓ [STREAM SUCCESS] ${K}`);break;case"fail":A(`✗ [STREAM FAILED] ${K}`);break}this._state=void 0}}var T=new Proxy(J,{get(R,K,q){if(!(K in R))return function(...z){let[E,Q]=[K,z[0]];if(Q&&typeof Q==="object")return J.type(E,Q),J.getLoggerInstance(E,Q);else throw new TypeError("Invalid arguments for adding a new logger getter.")};return Reflect.get(R,K,q)}});function C(){return T}function f(R){return J.plain.text(R)}var d=new Proxy(f,{get:(R,K)=>{if(Reflect.ownKeys(J).includes(K))return T[K];return Reflect.get(R,K)}});export{m as safeNavigator,d as logger,N as isWeChatMiniapp,X as isNode,F as isBrowser,C as createLogger,b as StreamLogger,J as Logger};
